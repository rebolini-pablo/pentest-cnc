import Pyro4
import os
import re
import time
import subprocess
 

@Pyro4.expose
class CommandDispatcher(object):
  def exec(self, cmd):
    logs_dir = "./"
    unixtime = int(time.time())
    parsed_cmd = cmd.replace(' ', '-').replace('.', '-').replace('~', '-')

    cmd += ">{}{}--{}".format(logs_dir, parsed_cmd, unixtime)

    output = subprocess.run(cmd, text=True, capture_output=True, shell=True)
    return output.stdout.strip()



daemon = Pyro4.Daemon()                # make a Pyro daemon
uri = daemon.register(CommandDispatcher)   # register the greeting maker as a Pyro object

print("Ready. Object uri =", uri)      # print the uri so we can use it in the client later
daemon.requestLoop()                   # start the event loop of the server to wait for calls